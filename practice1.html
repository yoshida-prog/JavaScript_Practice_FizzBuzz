<!DOCTYPE html>
<html lang="ja" dir="ltr">
  <head>
    <meta charset="utf-8">
    <title>JavaScript課題2</title>
  </head>
  <body>
    <!-- formタグのname属性とonclick属性が同名だとエラー -->
    <form name="form" action="index.html">
      <span>fizz</span>
      <input type="text" name="fizz" id="fizz"><br>
      <span>buzz</span>
      <input type="text" name="buzz" id="buzz">
      <div id="fizzbuzzBox">

      </div>
    </form>
    <input type="button" value="start" onclick="fizzbuzz()">
    <script>
    // fizzbuzzをp要素にしてid=fizzbuzzBoxの要素に格納する関数
    function addElement(fb, forb){
      var newP = document.createElement("p");
      newP.innerHTML = fb + "," + forb;
      document.getElementById("fizzbuzzBox").appendChild(newP);
    }

      function fizzbuzz(){
        var fizz = form.fizz.value;
        var buzz = form.buzz.value;
        var fizztext = "fizz";
        var buzztext = "buzz";
        var fizzbuzztext = "fizzbuzz";
        // フォームの値が数字であるか判定。数字でない場合はアラート。
        if(fizz.match(/^-?[0-9]+$/) && buzz.match(/^-?[0-9]+$/)){
          fizz = Number(fizz);
          buzz = Number(buzz);
          // fizzbuzzの場合のフラグ
          var flug = 0;
          // fizz,buzzの初期値。倍数にするときにこれを足す。
          initialFizz = fizz;
          initialBuzz = buzz;
          // fizz,buzzの倍数を作る関数
          function fizz_plus(){
            fizz = fizz + initialFizz;
          }
          function buzz_plus(){
            buzz = buzz + initialBuzz;
          }
          // fizz,buzzのループ
          while(fizz<100 || buzz<100){
            // fizz,buzzどちらが大きいか判定して先に表示する方を決める。
            if(fizz>buzz){
              //そうすることでfizz,buzzどちらかの二桁判定で済む。
              if(fizz<100){
                // 当然buzzの方が小さいのでまずはbuzzを表示。
                addElement(buzz,buzztext);
                //ループでbuzzがfizzより大きい値になるまでbuzzを表示。
                while(buzz+initialBuzz <= fizz){
                  buzz_plus();
                  // どこかでfizzと同値になるのでここでfizzbuzz分岐
                  if(fizz == buzz){
                    addElement(buzz,fizzbuzztext);
                    // このif文を抜けたら表示するとfizzとbuzzを表示してしまうのでフラグ建て。
                    flug = 1;
                  }
                  // もしfizzbuzz判定であればbuzzを表示しない。
                  if(flug != 1){
                    addElement(buzz,buzztext);
                  }
                }
                // もしfizzbuzz判定であればfizzを表示しない。
                if(flug != 1){
                  addElement(fizz,fizztext);
                }
                fizz_plus();
                buzz_plus();
                flug = 0;
              }else{   //fizzが三桁になったらbuzzのみ処理する。
                addElement(buzz,buzztext);
                buzz_plus();
              }
            }else if(buzz>fizz){   //buzz>fizzの場合も上記と同様に処理。
              if(buzz<100){
                addElement(fizz,fizztext);
                while(fizz+initialFizz <= buzz){
                  fizz_plus();
                  if(buzz == fizz){
                    addElement(fizz,fizzbuzztext);
                    flug = 1;
                  }
                  if(flug != 1){
                    addElement(fizz,fizztext);
                  }
                }
                if(flug != 1){
                  addElement(buzz,buzztext);
                }
                fizz_plus();
                buzz_plus();
                flug = 0;
              }else{
                addElement(fizz,fizztext);
                fizz_plus();
              }
            }else{   //fizzとbuzzがそもそも同値で入力されていればこちら。
              addElement(fizz,fizzbuzztext);
              fizz_plus();
            }
          }
        }else{
          alert("自然数で入力してください");
          //テキストボックスを空にする。これでいちいちテキストボックス内を消さなくてよい。
          form.fizz.value = "";
          form.buzz.value = "";
        }
      }
    </script>
  </body>
</html>
